# 실행 기록 - 2025-09-20 19:24

## 작업 개요
Windows 환경에서 WSL(Windows Subsystem for Linux)로 이전 후 발생한 Frontend Next.js 실행 오류 해결

## 문제 상황

### 🚨 발생한 문제
1. **UNC 경로 오류**: Windows 경로와 WSL 경로 혼재로 인한 실행 불가
2. **권한 문제**: `EPERM: operation not permitted, mkdir 'C:\Windows\.next'`
3. **Node.js/npm 환경 충돌**: Windows Node.js와 WSL Node.js 혼재 사용

### 📋 에러 메시지
```
'\\wsl.localhost\Ubuntu-24.04\home\wide\projects\systrading\stock-trading-ui'
가는 경로가 현재 디렉터리에 대해 CMD.EXE가 실행되었습니다. UNC 경로는
지원되지 않습니다. Windows 디렉터리를 기본값으로 둡니다.

Error: EPERM: operation not permitted, mkdir 'C:\Windows\.next'
```

## 해결 과정

### 1. 환경 진단 (19:05)
```bash
# Node.js와 npm 버전 및 경로 확인
which node    # /usr/bin/node (WSL 네이티브)
node --version # v18.19.1
which npm     # /mnt/c/Node.js//npm (Windows 경로!)
npm --version # 11.5.2
```

**문제 식별**: Node.js는 WSL 네이티브를 사용하지만 npm은 Windows 경로를 참조

### 2. 임시 파일 정리 (19:08)
```bash
rm -rf .next  # 기존 빌드 캐시 삭제
```

### 3. NVM을 통한 Node.js 환경 재구축 (19:10)
```bash
# NVM 설치
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash

# 환경 설정 및 Node.js LTS 설치
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
nvm install --lts && nvm use --lts
```

**결과**: Node.js v22.19.0, npm v10.9.3 (모두 WSL 네이티브)

### 4. 의존성 재설치 (19:15)
```bash
# 기존 의존성 완전 삭제 후 재설치
rm -rf node_modules package-lock.json
npm install
```

**결과**: 381개 패키지 설치 완료, 취약점 0개

### 5. Frontend 서버 실행 테스트 (19:18)
```bash
export NVM_DIR="$HOME/.nvm" && [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
npm run dev
```

**결과**: ✅ 성공적으로 실행
- Local: http://localhost:9000
- Network: http://10.255.255.254:9000
- Ready in 950ms

### 6. start-server.sh 스크립트 검증 (19:20)
```bash
./scripts/start-server.sh
```

**결과**: ✅ 스크립트도 정상 작동
- WSL 환경 자동 감지
- Node.js 직접 실행으로 우회
- Ready in 1058ms

## 적용된 해결책

### ✅ 핵심 해결 방법
1. **NVM 환경 구축**: WSL 전용 Node.js 환경 완전 분리
2. **의존성 재설치**: Windows 바이너리와 WSL 바이너리 호환성 문제 해결
3. **환경 변수 설정**: PATH에서 Windows Node.js 경로 우선순위 문제 해결

### ✅ 스크립트 검증 결과
`scripts/start-server.sh`의 WSL 환경 대응 기능 확인:
- WSL 환경 자동 감지 (`$WSL_DISTRO_NAME`, `$WSLENV` 확인)
- Node.js 직접 실행으로 Windows CMD 우회
- 포트 9000 고정 및 자동 충돌 해결

## 현재 상태

### 🚀 성공적으로 해결된 사항
- [x] Frontend Next.js 서버 정상 실행
- [x] WSL 네이티브 Node.js v22.19.0 환경
- [x] npm v10.9.3 정상 작동
- [x] `npm run dev` 명령어 정상 실행
- [x] `./scripts/start-server.sh` 스크립트 정상 실행
- [x] Turbopack 빌드 최적화 활성화

### 📊 성능 지표
- **빌드 시간**: 950ms ~ 1058ms
- **포트**: 9000 (고정)
- **네트워크 접근**: 0.0.0.0:9000 (외부 접근 가능)

### 🔧 환경 설정
```bash
# WSL에서 Frontend 실행을 위한 환경 설정 명령어
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

# 실행 방법
npm run dev                    # 직접 실행
./scripts/start-server.sh      # 스크립트 실행
```

## 향후 주의사항

### ⚠️ WSL 환경 유지 관리
1. **Node.js 환경**: 항상 NVM을 통해 WSL 네이티브 버전 사용
2. **PATH 관리**: Windows Node.js 경로가 우선되지 않도록 주의
3. **의존성 관리**: Windows와 WSL 간 바이너리 호환성 주의

### 📝 권장 워크플로우
```bash
# 새 터미널 세션에서 작업 시
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
nvm use --lts

# Frontend 개발 서버 실행
cd stock-trading-ui
npm run dev
```

## 작업 완료 시간
- **시작**: 2025-09-20 19:05
- **완료**: 2025-09-20 19:24
- **소요 시간**: 19분

## 관련 파일
- `/home/wide/projects/systrading/stock-trading-ui/scripts/start-server.sh`
- `/home/wide/projects/systrading/stock-trading-ui/package.json`
- `/home/wide/projects/systrading/stock-trading-ui/next.config.ts`

## 기술 스택
- **OS**: WSL2 (Ubuntu 24.04)
- **Node.js**: v22.19.0 (via NVM)
- **npm**: v10.9.3
- **Next.js**: 15.5.2 (Turbopack)
- **환경**: Development